namespace SpriteKind {
    export const menuElement = SpriteKind.create()
    export const trackPreview = SpriteKind.create()
}
function setUpTrack2 () {
    trackImage = img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `
    collisionImage = img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `
    finishLineX0 = 21
    finishLineY0 = 66
    finishLineX1 = 23
    finishLineY1 = 78
    pxPrev = px = 8
pyPrev = py = 76
heading = 45
}
function drawSprites () {
    // renderer.place3dImage(ballImage, 10, 73, 0, 1)
    // renderer.place3dImage(ballImage, 11, 72, 0, 1)
    for (let i = 0; i <= img1X.length - 1; i++) {
        let j = 0
        renderer.place3dImage(TrackObjects[TrackSelected * 4 - 0], img1X[j], img1Y[j], 0, 10)
    }
    // renderer.place3dImage(ballImage, 10, 73, 0, 1)
    // renderer.place3dImage(ballImage, 11, 72, 0, 1)
    for (let k = 0; k <= img2X.length - 1; k++) {
        renderer.place3dImage(TrackObjects[TrackSelected * 4 + 1], img2X[k], Img2Y[k], 0, 10)
    }
    // renderer.place3dImage(ballImage, 10, 73, 0, 1)
    // renderer.place3dImage(ballImage, 11, 72, 0, 1)
    for (let l = 0; l <= img3X.length - 1; l++) {
        renderer.place3dImage(TrackObjects[TrackSelected * 4 + 2], img3X[l], img3Y[l], 0, 10)
    }
    // renderer.place3dImage(ballImage, 10, 73, 0, 1)
    // renderer.place3dImage(ballImage, 11, 72, 0, 1)
    for (let m = 0; m <= img4X.length - 1; m++) {
        renderer.place3dImage(TrackObjects[TrackSelected * 4 + 3], img4X[m], img4Y[m], 0, 10)
    }
}
// console.log("Number of trees=" + treeX.length)
function initializeTrack () {
    respawnX = []
    respawnY = []
    img2X = []
    Img2Y = []
    img1X = []
    img1X = []
    for (let x = 0; x <= trackImage.width - 1; x++) {
        for (let y = 0; y <= trackImage.height - 1; y++) {
            if (collisionImage.getPixel(x, y) == 10) {
                respawnX.push(x)
                respawnY.push(y)
                collisionImage.setPixel(x, y, 1)
            } else if (collisionImage.getPixel(x, y) == 4) {
                img1X.push(x)
                img1Y.push(y)
                spriteutils.fillCircle(
                collisionImage,
                x,
                y,
                2,
                3
                )
            } else if (collisionImage.getPixel(x, y) == 5) {
                img2X.push(x)
                Img2Y.push(y)
                spriteutils.fillCircle(
                collisionImage,
                x,
                y,
                3,
                3
                )
            } else if (collisionImage.getPixel(x, y) == 6) {
                img3X.push(x)
                img3Y.push(y)
                spriteutils.fillCircle(
                collisionImage,
                x,
                y,
                4,
                3
                )
            } else if (collisionImage.getPixel(x, y) == 7) {
                img4X.push(x)
                img4Y.push(y)
                spriteutils.fillCircle(
                collisionImage,
                x,
                y,
                5,
                3
                )
            } else {
            	
            }
        }
    }
}
function configure () {
    renderer.setBackgroundImage(assets.image`background`)
renderer.setZClipFar(zFar)
controller.player1.analog = true
}
function setarrays () {
    ImagesForCharacters = [
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . 7 . . 7 . . 7 7 7 . . . . . 
        . . 7 . 7 . . . 7 . 7 . . . . . 
        . . 7 7 . . . . 7 7 7 . . . . . 
        . . 7 7 . . . . 7 . . . . . . . 
        . . 7 . 7 . . . 7 . . . . . . . 
        . . 7 . f f f f f . . . . . . . 
        . . . f f f f f f f . . . . . . 
        . . . f f f f f f f . . . . . . 
        . . . f 1 1 1 1 1 f . . . . . . 
        . . . 1 f f f f f 1 . . . . . . 
        . f f 1 f b b b f 1 f f . . . . 
        . f f 1 f f f f f 1 f f . . . . 
        . f f b 1 1 1 1 1 b f f . . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . e e e e e . . . . . . 
        . . . . . e e e e e . . . . . . 
        . . . . . e e e e e . . . . . . 
        . . . . . e e e e e . . . . . . 
        . . . . . d d d d d . . . . . . 
        . . . . . f f f f f . . . . . . 
        . . . f f f f f f f f f . . . . 
        . . . f f f f f f f f f . . . . 
        . . . f f f f f f f f f . . . . 
        . . . f f f f f f f f f . . . . 
        . . . f f 1 1 1 1 1 f f . . . . 
        . . . . 1 f f f f f 1 . . . . . 
        . . f f 1 f b b b f 1 f f . . . 
        . . f f 1 f f f f f 1 f f . . . 
        . . f f b 1 1 1 1 1 b f f . . . 
        `,
    img`
        . . . . f f . . . . . . . . . . 
        . . . . f f f f f . . . . . . . 
        . . . 2 f f f f f . . . . . . . 
        . . . . f f f f f . . . . . . . 
        . . . . f f f f f 1 . . . . . . 
        . . . . d f 1 1 1 1 1 . . . . . 
        . . . . b b f f 1 1 1 . . . . . 
        . . b b b f f f f b b . . . . . 
        . . b b b f f f b b b . . . . . 
        . . b b b f f f b b b . . . . . 
        . . b b b f f f b b b . . . . . 
        . . b b 1 1 1 1 1 b b . . . . . 
        . . . 1 f f f f f 1 . . . . . . 
        . f f 1 f b b b f 1 f f . . . . 
        . f f 1 f f f f f 1 f f . . . . 
        . f f b 1 1 1 1 1 b f f . . . . 
        `,
    img`
        . . . . . . f f f f f . . . . . 
        . . . . . . f f f f f . . . . . 
        . . . . . . f f f f f . . . . . 
        . . . . . . f f f f f . . . . . 
        . . . . . . f f f f f . . . . . 
        . . . . f f f f f f f f . . . . 
        . . . . . 5 5 5 5 5 5 . . . . . 
        . . . . . 5 5 5 5 5 5 . . . . . 
        . . . . 5 5 5 5 5 5 5 5 . . . . 
        . . . . 5 5 5 5 5 5 5 5 . . . . 
        . . . . 5 5 5 5 5 5 5 5 . . . . 
        . . . . 8 8 8 8 8 8 8 8 . . . . 
        . . . . 8 8 8 8 8 8 8 8 . . . . 
        . . . . f f f f f f f f . . . . 
        . . . . f f f f f f f f . . . . 
        . . . . f f . . . . f f . . . . 
        `,
    img`
        . . . . . . e . e . . . . . . . 
        . . . . . e e e e e . . . . . . 
        . . . . e e e e e e e . . . . . 
        . . . . e e e e e e e . . . . . 
        . . . . . e e e e e . . . . . . 
        . . . . . d e e e d . . . . . . 
        . . . . . c c e c c . . . . . . 
        . . . c c c c c c c c c . . . . 
        . . . c c c c c c c c c . . . . 
        . . . c c c c c c c c c . . . . 
        . . . c c c c c c c c c . . . . 
        . . . c c 1 1 1 1 1 c c . . . . 
        . . . . 1 f f f f f 1 . . . . . 
        . . f f 1 f b b b f 1 f f . . . 
        . . f f 1 f f f f f 1 f f . . . 
        . . f f b 1 1 1 1 1 b f f . . . 
        `,
    img`
        f f f f f f f f f f f f f f f f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . f f f f . . . . . f 
        f . . . . f . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . f . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f f f f f f f f f f f f f f f f 
        `,
    img`
        f f f f f f f f f f f f f f f f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . f f f f . . . . . f 
        f . . . . f . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . f . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f f f f f f f f f f f f f f f f 
        `,
    img`
        f f f f f f f f f f f f f f f f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . f f f f . . . . . f 
        f . . . . f . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . f . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f f f f f f f f f f f f f f f f 
        `
    ]
    CharacterAnimateLeft = [
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . 6 7 . 6 7 . 6 7 7 7 . . . . 
        . . 6 7 6 7 . . 6 7 6 7 . . . . 
        . . 6 7 7 . . . 6 7 7 7 . . . . 
        . . 6 7 7 . . . 6 7 . . . . . . 
        . . 6 7 6 7 . . 6 7 . . . . . . 
        . . 6 7 . 6 f f f f f . . . . . 
        . . . . f f f f f f f f . . . . 
        . . . . f f f f f f f f . . . . 
        . . . . f f 1 1 1 1 1 f . . . . 
        . . . b b 1 f f f f f 1 . . . . 
        . . f f f 1 f b b b f 1 f . . . 
        . . f f f 1 f f f f f 1 f . . . 
        . . . f f b 1 1 1 1 1 b f . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . e e e e e . . . . . . 
        . . . . . d d e e e . . . . . . 
        . . . . . f d d e e . . . . . . 
        . . . . . d d d e e . . . . . . 
        . . . . . d d d d d . . . . . . 
        . . . . . f f f f f . . . . . . 
        . . . . f f f f f f f f . . . . 
        . . . f f f f f f f f f . . . . 
        . . . f f f f f f f f f . . . . 
        . . . f f f f f f f f f . . . . 
        . . . . f f 1 1 1 1 1 f . . . . 
        . . . b b 1 f f f f f 1 . . . . 
        . . f f f 1 f b b b f 1 f . . . 
        . . f f f 1 f f f f f 1 f . . . 
        . . . f f b 1 1 1 1 1 b f . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . f f f f f . . . . . . 
        . . . . 2 2 f f f f . . . . . . 
        . . . . 2 2 f f f f . . . . . . 
        . . . . . 2 f f f f . 1 . . . . 
        . . . . . 2 f f f f . 1 1 1 1 . 
        . . . . . b d d d b 1 1 1 1 1 . 
        . . . . b b b b b f f f 1 1 . . 
        . . . b b b b f f f f f f . . . 
        . . . b b b f f f f f f . . . . 
        . . . b b b f f f f f b . . . . 
        . . . . b b 1 1 1 1 1 b . . . . 
        . . . c c 1 f f f f f 1 . . . . 
        . . f f f 1 f b b b f 1 f . . . 
        . . f f f 1 f f f f f 1 f . . . 
        . . . f f b 1 1 1 1 1 b f . . . 
        `,
    img`
        . . . . . f f f . . . . . . . . 
        f f . . . f f f . . . . . . . . 
        5 5 . . . f f f . . . . . . . . 
        5 5 . f f f f f f f . . . f f . 
        5 5 . . 5 5 5 5 5 . . . . f f . 
        5 5 . . 5 5 5 5 5 5 . . . 5 5 . 
        5 5 5 . f 5 f 5 5 5 . . 5 5 5 . 
        5 5 5 . 5 5 5 5 5 8 8 8 5 5 5 . 
        5 5 5 8 5 5 5 5 5 8 . . . . . . 
        5 5 5 8 8 8 8 8 8 8 . . . . . . 
        . . . 8 8 8 8 8 8 8 . f f . . . 
        . . . . 8 8 f f f f f f f . . . 
        . . . f f f f f f f f f f f . . 
        . f f f f f f f f f f f f f . . 
        . f f f f f f f f . . . f f . . 
        . . f f f . . . . . . . . . . . 
        `,
    img`
        . . . . e . . . . . . . . . . . 
        . . . . e e e e e e e . . . . . 
        . . . . . f e e e e e . . . . . 
        . . . . . f e d e e e . . . . . 
        . . . . . d d d e e e . . . . . 
        . . . . . d d d d e e . . . . . 
        . . . . . c c c c e . . . . . . 
        . . . . c c c c c c c c . . . . 
        . . . c c c c c c c c c . . . . 
        . . . c c c c c c c c c . . . . 
        . . . c c c c c c c c c . . . . 
        . . . . c c 1 1 1 1 1 c . . . . 
        . . . b b 1 f f f f f 1 . . . . 
        . . f f f 1 f b b b f 1 f . . . 
        . . f f f 1 f f f f f 1 f . . . 
        . . . f f b 1 1 1 1 1 b f . . . 
        `,
    img`
        f f f f f f f f f f f f f f f f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . f f f f . . . . . f 
        f . . . . f . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . f . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f f f f f f f f f f f f f f f f 
        `,
    img`
        f f f f f f f f f f f f f f f f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . f f f f . . . . . f 
        f . . . . f . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . f . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f f f f f f f f f f f f f f f f 
        `,
    img`
        f f f f f f f f f f f f f f f f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . f f f f . . . . . f 
        f . . . . f . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . f . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f f f f f f f f f f f f f f f f 
        `
    ]
    CharacterAnimateRight = [
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . 7 6 . 7 6 . 7 7 7 6 . . . 
        . . . 7 6 7 6 . . 7 6 7 6 . . . 
        . . . 7 7 6 . . . 7 7 7 6 . . . 
        . . . 7 7 6 . . . 7 6 . . . . . 
        . . . 7 6 7 6 . . 7 6 . . . . . 
        . . . 7 f f f f f 7 6 . . . . . 
        . . . f f f f f f f f . . . . . 
        . . . f f f f f f f f . . . . . 
        . . . f 1 1 1 1 1 f f . . . . . 
        . . . 1 f f f f f 1 b b . . . . 
        . . f 1 f b b b f 1 f f f . . . 
        . . f 1 f f f f f 1 f f f . . . 
        . . f b 1 1 1 1 1 b f f . . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . e e e e e . . . . . . 
        . . . . . e e e d d . . . . . . 
        . . . . . e e d d f . . . . . . 
        . . . . . e e d d d . . . . . . 
        . . . . . d d d d d . . . . . . 
        . . . . . f f f f f . . . . . . 
        . . . f f f f f f f f . . . . . 
        . . . f f f f f f f f f . . . . 
        . . . f f f f f f f f f . . . . 
        . . . f f f f f f f f f . . . . 
        . . . f 1 1 1 1 1 f f . . . . . 
        . . . 1 f f f f f 1 b b . . . . 
        . . f 1 f b b b f 1 f f f . . . 
        . . f 1 f f f f f 1 f f f . . . 
        . . f b 1 1 1 1 1 b f f . . . . 
        `,
    img`
        . . . . . f f f . f . . . . . . 
        . . . . . f f f f f f . . . . . 
        . . . . . f f f f f 2 . . . . . 
        . . . . . f f f 1 6 . . . . . . 
        . . . 1 . f f d 1 7 . . . . . . 
        . 1 1 1 . f d d d d . . . . . . 
        . 1 1 f f f d d d b . . . . . . 
        . 1 1 1 f f f b b b b . . . . . 
        . . f f f f f b b b b b . . . . 
        . . . f f f f f b b b b . . . . 
        . . . b b f f f b b b b . . . . 
        . . . b 1 1 1 1 1 b b . . . . . 
        . . . 1 f f f f f 1 c c . . . . 
        . . f 1 f b b b f 1 f f f . . . 
        . . f 1 f f f f f 1 f f f . . . 
        . . f b 1 1 1 1 1 b f f . . . . 
        `,
    img`
        . . . . . . . . f f f . . . . . 
        . . . . . . . . f f f . . . f f 
        . . . . . . . . f f f . . . 5 5 
        . f f . . . f f f f f f f . 5 5 
        . f f . . . . 5 5 5 5 5 . . 5 5 
        . 5 5 . . . 5 5 5 5 5 5 . . 5 5 
        . 5 5 5 . . 5 5 5 f 5 f . 5 5 5 
        . 5 5 5 8 8 8 5 5 5 5 5 . 5 5 5 
        . . . . . . 8 5 5 5 5 5 8 5 5 5 
        . . . . . . 8 8 8 8 8 8 8 5 5 5 
        . . . f f . 8 8 8 8 8 8 8 . . . 
        . . . f f f f f f f 8 8 . . . . 
        . . f f f f f f f f f f f . . . 
        . . f f f f f f f f f f f f f . 
        . . f f . . . f f f f f f f f . 
        . . . . . . . . . . . f f f . . 
        `,
    img`
        . . . . . . . . . . e . . . . . 
        . . . . e e e e e e e . . . . . 
        . . . . e e e e e f . . . . . . 
        . . . . e e e d e f . . . . . . 
        . . . . e e e d d d . . . . . . 
        . . . . e e d d d d . . . . . . 
        . . . . . e c c c c . . . . . . 
        . . . c c c c c c c c . . . . . 
        . . . c c c c c c c c c . . . . 
        . . . c c c c c c c c c . . . . 
        . . . c c c c c c c c c . . . . 
        . . . c 1 1 1 1 1 c c . . . . . 
        . . . 1 f f f f f 1 b b . . . . 
        . . f 1 f b b b f 1 f f f . . . 
        . . f 1 f f f f f 1 f f f . . . 
        . . f b 1 1 1 1 1 b f f . . . . 
        `,
    img`
        f f f f f f f f f f f f f f f f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . f f f f . . . . . f 
        f . . . . f . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . f . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f f f f f f f f f f f f f f f f 
        `,
    img`
        f f f f f f f f f f f f f f f f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . f f f f . . . . . f 
        f . . . . f . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . f . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f f f f f f f f f f f f f f f f 
        `,
    img`
        f f f f f f f f f f f f f f f f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . f f f f . . . . . f 
        f . . . . f . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . . f . . . . f 
        f . . . . . . . . f . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . f . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f . . . . . . . . . . . . . . f 
        f f f f f f f f f f f f f f f f 
        `
    ]
    TrackObjects = [
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        ........2222222222222222........
        ......22244444444444444222......
        ......24444444444444444442......
        .....2244444444444444444422.....
        .....2444444422444444444442.....
        ....224444442222444444444422....
        ....244444444224444444444442....
        ...22444455544444444444444422...
        ...24444555554444444444444442...
        ..2244444555444444444454444422..
        ..2444444444444444444555444442..
        .224444444444444444444544444422.
        .244444444444444444444444444442.
        22444444424444444444444444422422
        24444444222444444444444444222242
        24444442222244444444444444422442
        24444444222444444444444444444442
        24445444424444444445554444444442
        24555544444444444555555444444442
        24455554444444444455544444444442
        24445544444444444444444444444442
        24444444444444444444444444444442
        24444444444444444444444444444442
        24444444444444444444444455444442
        22444444444444444444444555544422
        .244444444444442222444455554442.
        .244444454444422222244445544442.
        .244444555444444222444444444442.
        .244444454444444444444444444442.
        .244444444444444444444444444442.
        .224444444444444444444444444422.
        ..2244444444444444444444444422..
        ...22444444444444444444444422...
        ....222444444444444444444222....
        ......22244444444444444222......
        ........2224444444444222........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ...........feeeeeeeef...........
        ..........feeeeeeeeeef..........
        .........feeeeffffeeeef.........
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    assets.image`tree`,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        ................................
        ................................
        ................................
        ................................
        ................................
        .................777777777......
        ...............7777777777777....
        ..............777777777777777...
        .....7777777777777777777777777..
        ....77777777777777777777777777..
        ...7777777777777777777777777777.
        ..77777777777777777777777777777.
        .777777777777777777777777777777.
        .777777777777777777777777777777.
        .777777777777777777777777777777.
        .777777777777777777777777777777.
        .777777777777777777777777777777.
        .777777777777777777777777777777.
        .777777777777777777777777777777.
        .77777777777777777777777777777..
        .77777777777777777777777777777..
        ..777777777777777777777777777...
        ...7777777777777777777777777....
        ....77777777777..777777777......
        .....777777777....eeeeeee.......
        .......eeeeee.....eeeeee........
        .......eeeeeee....eeeeee........
        ........eeeeee....eeeeee........
        ........eeeeee...eeeeee.........
        ........eeeeeee..eeeeee.........
        .........eeeeee..eeeeee.........
        .........eeeeee..eeeeee.........
        .........eeeeeeeeeeeee..........
        ..........eeeeeeeeeeee..........
        ..........eeeeeeeeeeee..........
        ..........eeeeeeeeeeee..........
        ...........eeeeeeeeee...........
        ...........eeeeeeeeee...........
        ...........eeeeeeeeee...........
        ...........eeeeeeeeee...........
        ............eeeeeeeee...........
        ............eeeeeeeee...........
        ............eeeeeeeee...........
        .............eeeeeeee...........
        .............eeeeeeee...........
        .............eeeeeeee...........
        ..............eeeeeee...........
        ..............eeeeeee...........
        ..............eeeeeee...........
        ...............eeeeee...........
        ...............eeeeee...........
        ...............eeeeee...........
        ................eeeee...........
        ................eeeee...........
        ................eeeee...........
        ................eeeee...........
        ................eeeee...........
        ................eeeee...........
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        ...........77777777777..........
        .........777777777777777........
        .......7777777777777777777......
        ......777777777777777777777.....
        .....77777777777777777777777....
        ....7777777777777777777777777...
        ...777777777777777777777777777..
        ...777777777777777777777777777..
        ..77777777777777777777777777777.
        ..77777777777777777777777777777.
        .7777777777777777777777777777777
        .7777777777777777777777777777777
        .7777777777777777777777777777777
        .7777777777777777777777777777777
        .7777777777777777777777777777777
        .7777777777777777777777777777777
        .7777777777777777777777777777777
        .7777777777777777777777777777777
        .7777777777777777777777777777777
        .7777777777777777777777777777777
        .7777777777777777777777777777777
        ..77777777777777777777777777777.
        ..77777777777777777777777777777.
        ...777777777777777777777777777..
        ...777777777777777777777777777..
        ....7777777777777777777777777...
        .....77777777777777777777777....
        ......777777777777777777777.....
        ......e7777777777777777777e.....
        ......eee777777777777777eee.....
        ......eeeee77777777777eeeee.....
        ......eeeeeeeeeeeeeeeeeeeee.....
        .....eeeeeeeeeeeeeeeeeeeeeee....
        .....eeeeeeeeeeeeeeeeeeeeeee....
        .....eeeeeeeeeeeeeeeeeeeeeee....
        .....eeeeeeeeeeeeeeeeeeeeeee....
        .....eeeeeeeeeeeeeeeeeeeeeee....
        .....eeeeeeeeeeeeeeeeeeeeeee....
        .....eeeeeeeeeeeeeeeeeeeeeee....
        .....eeeeeeeeeeeeeeeeeeeeeee....
        .....eeeeeeeeeeeeeeeeeeeeeee....
        .....eeeeeeeeeeeeeeeeeeeeeee....
        .....eeeeeeeeeeeeeeeeeeeeeee....
        .....eeeeeeeeeeeeeeeeeeeeeee....
        ....eeeeeeeeeeeeeeeeeeeeeeeee...
        ....eeeeeeeeeeeeeeeeeeeeeeeee...
        ....eeeeeeeeeeeeeeeeeeeeeeeee...
        ....eeeeeeeeeeeeeeeeeeeeeeeee...
        ...eeeeeeeeeeeeeeeeeeeeeeeeeee..
        ...eeeeeeeeeeeeeeeeeeeeeeeeeee..
        ...eeeeeeeeeeeeeeeeeeeeeeeeeee..
        ...eeeeeeeeeeeeeeeeeeeeeeeeeee..
        ...eeeeeeeeeeeeeeeeeeeeeeeeeee..
        ...eeeeeeeeeeeeeeeeeeeeeeeeeee..
        ...eeeeeeeeeeeeeeeeeeeeeeeeeee..
        ...eeeeeeeeeeeeeeeeeeeeeeeeeee..
        ...eeeeeeeeeeeeeeeeeeeeeeeeeee..
        ...eeeeeeeeeeeeeeeeeeeeeeeeeee..
        `
    ]
    ImagesForCups = [
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        1 1 . 1 . . 1 1 1 . 1 1 . 1 . 1 
        1 . . 1 . . . 1 . . 1 . . 1 1 . 
        1 1 . 1 1 . 1 1 1 . 1 1 . 1 . 1 
        . . . . . . . . . . . . . . . . 
        1 . 1 . 1 1 1 . 1 1 . . 1 1 1 . 
        1 1 1 . 1 1 . . 1 1 1 . 1 1 . . 
        1 . 1 . 1 1 1 . 1 . 1 . 1 1 1 . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . 1 1 1 1 1 1 . . . . . 
        . . . . 1 . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . 1 . . . . . 
        . . . . . . . . . 1 . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . 1 1 1 1 1 1 . . . . . 
        . . . . 1 . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . 1 . . . . . 
        . . . . . . . . . 1 . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . 1 1 1 1 1 1 . . . . . 
        . . . . 1 . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . 1 . . . . . 
        . . . . . . . . . 1 . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . 1 1 1 1 1 1 . . . . . 
        . . . . 1 . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . 1 . . . . . 
        . . . . . . . . . 1 . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . 1 1 1 1 1 1 . . . . . 
        . . . . 1 . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . 1 . . . . . 
        . . . . . . . . . 1 . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . 1 1 1 1 1 1 . . . . . 
        . . . . 1 . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . 1 . . . . . 
        . . . . . . . . . 1 . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . 1 1 1 1 1 1 . . . . . 
        . . . . 1 . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . . 1 . . . . 
        . . . . . . . . . . 1 . . . . . 
        . . . . . . . . . 1 . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . 1 . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `
    ]
    TrackNames = [
    "Autumn Lake",
    "Scorching Dynasty",
    "Forest Circuit",
    "Colorful Road"
    ]
    ImagesForTracks = [
    img`
        f f f f f f f f f f f f f f f f 
        f 4 e e e e e e e e e e 4 4 4 f 
        f e 4 4 4 4 4 4 4 4 4 4 e e 4 f 
        f 4 4 4 4 4 4 4 4 4 4 4 4 4 e f 
        f 4 4 9 9 9 9 9 9 9 4 4 4 4 4 f 
        f 4 9 9 9 9 9 9 9 9 9 9 9 9 4 f 
        f 4 9 9 9 9 9 9 9 9 9 9 9 9 9 f 
        f 4 9 9 9 9 9 9 9 9 9 9 9 9 9 f 
        f 4 9 9 9 9 9 9 9 9 9 9 9 9 9 f 
        f 4 4 9 9 9 9 9 9 9 9 9 9 9 9 f 
        f e 4 4 4 4 9 9 9 9 9 9 9 9 9 f 
        f e e 4 4 4 4 4 4 9 9 9 9 9 9 f 
        f e e e 4 4 4 4 4 4 4 4 4 4 4 f 
        f 4 e e e e e e e 4 4 4 4 4 4 f 
        f 4 4 e e e e e e e e e e 4 4 f 
        f f f f f f f f f f f f f f f f 
        `,
    img`
        f f f f f f f f f f f f f f f f 
        f 9 9 9 9 9 9 9 9 9 9 9 9 9 9 f 
        f 9 9 9 9 9 9 9 9 9 9 9 9 9 9 f 
        f 9 9 9 e e e 9 9 9 9 9 9 9 9 f 
        f e e e e e e 9 9 9 9 9 9 e e f 
        f e e e e e e 9 9 9 9 9 e e e f 
        f 9 9 9 9 9 9 9 9 9 9 9 9 9 9 f 
        f 9 9 9 9 9 9 9 9 2 9 2 9 9 2 f 
        f 9 9 2 9 9 2 9 9 9 9 9 9 9 9 f 
        f 9 2 9 9 9 9 9 9 2 9 9 2 9 9 f 
        f 9 9 9 2 9 9 2 9 9 9 9 9 9 9 f 
        f 2 2 2 2 2 2 2 2 2 2 2 2 2 2 f 
        f 2 2 2 2 2 2 2 2 2 2 2 2 2 2 f 
        f 2 2 2 2 2 2 2 2 2 2 2 2 2 2 f 
        f 2 2 2 2 2 2 2 2 2 2 2 2 2 2 f 
        f f f f f f f f f f f f f f f f 
        `,
    img`
        f f f f f f f f f f f f f f f f 
        f 7 7 7 7 7 7 7 b b b 7 7 7 7 f 
        f 7 7 7 7 7 7 7 7 b b 7 7 7 7 f 
        f 7 7 7 7 7 7 7 7 b b 7 7 7 7 f 
        f 7 7 b b b b b b b b 7 7 7 7 f 
        f 7 7 b b 7 7 7 7 7 7 7 7 7 7 f 
        f 7 7 b b 7 7 7 7 7 7 7 7 7 7 f 
        f 7 7 b b b b b b b b b 7 7 7 f 
        f 7 7 b b b b b b b b b b 7 7 f 
        f 7 7 7 b b b b b b b b b 7 7 f 
        f 7 7 7 7 7 7 b b b b b b b 7 f 
        f 7 7 7 7 7 7 b b b b b b b 7 f 
        f 7 7 7 7 7 7 b b b b b b b 7 f 
        f 7 7 7 7 7 7 b b b b b b b 7 f 
        f 7 7 7 7 7 7 b b b b b b b 7 f 
        f f f f f f f f f f f f f f f f 
        `,
    img`
        f f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f f 
        f f f a 2 4 5 5 f f f f f f f f 
        f f f a 2 4 5 5 5 f f f f f f f 
        f f f f a 2 4 5 5 9 f f f f f f 
        f f f f f f f f 9 f f f f f f f 
        f f 8 8 f f f f f f f f f f f f 
        f f f f f f f f f f 7 7 f f f f 
        f f 6 6 f f f f f 7 7 9 f f f f 
        f f 9 9 f f f f f 9 9 9 f f f f 
        f f 7 7 f f 3 a f 6 6 6 f f f f 
        f f 5 5 f 2 3 a 8 6 6 f f f f f 
        f f f 5 4 2 f a 8 8 f f f f f f 
        f f f f 4 f f f f f f f f f f f 
        f f f f f f f f f f f f f f f f 
        `
    ]
    TrackCollision_Images = 0
    OutsideTrackColors = [
    4,
    2,
    7,
    15
    ]
}
function getTerrainTypePoint (xf: number, yf: number) {
    x2 = Math.round(xf)
    y2 = Math.round(yf)
    if (x2 >= finishLineX0 && x2 <= finishLineX1 && y2 >= finishLineY0 && y2 <= finishLineY1) {
        // console.log("x=" + x + " y=" + y + " finish line")
        return TerrainType.FINISH_LINE
    }
    terrain = collisionImage.getPixel(x2, y2)
    // console.log("x=" + x + " y=" + y + " terrain=" + terrain)
    if (terrain == 3) {
        return TerrainType.OBSTACLE
    } else if (terrain == 2) {
        return TerrainType.OFFROAD
    } else {
        return TerrainType.ROAD
    }
}
function getTerrainType (x0: number, y0: number, x1: number, y1: number) {
    range = Math.max(Math.abs(x1 - x0), Math.abs(y1 - y0))
    if (range <= 1) {
        return getTerrainTypePoint(x1, y1)
    }
    dx = (x1 - x0) / range
    dy = (y1 - y0) / range
    let terrain2 = TerrainType.ROAD
for (let t = 0; t <= range; t++) {
        newTerrain = getTerrainTypePoint(x0 + t * dx, y0 + t * dy)
        if (newTerrain == TerrainType.FINISH_LINE) {
            return TerrainType.FINISH_LINE
        }
        if (newTerrain == TerrainType.OBSTACLE) {
            terrain2 = TerrainType.OBSTACLE
        }
        if (newTerrain == TerrainType.OFFROAD && terrain2 == TerrainType.ROAD) {
            terrain2 = TerrainType.OFFROAD
        }
    }
    return terrain2
}
let outsideTrackColor = 0
let TrackPreview: Sprite = null
let mySprite: Sprite = null
let CupSelected = 0
let SelectedX = 0
let mySprite2: Sprite = null
let TrackName: TextSprite = null
let SelectedY = 0
let dot_V_Right = 0
let dot_V_Forward = 0
let forwardDrag = 0
let storedgliderspeed = 0
let memvarY = 0
let memvarX = 0
let gliding = 0
let fwdY = 0
let fwdX = 0
let seconds = 0
let lapTime = 0
let lapStart = 0
let onFinishLine = false
let isOffroad = false
let terrain3 = 0
let char = 0
let carVy = 0
let carVx = 0
let newTerrain = 0
let dx = 0
let range = 0
let terrain = 0
let y2 = 0
let x2 = 0
let OutsideTrackColors: number[] = []
let TrackCollision_Images = 0
let ImagesForTracks: Image[] = []
let TrackNames: string[] = []
let ImagesForCups: Image[] = []
let CharacterAnimateRight: Image[] = []
let CharacterAnimateLeft: Image[] = []
let ImagesForCharacters: Image[] = []
let respawnY: number[] = []
let respawnX: number[] = []
let img4Y: number[] = []
let img4X: number[] = []
let img3Y: number[] = []
let img3X: number[] = []
let Img2Y: number[] = []
let img2X: number[] = []
let img1Y: number[] = []
let TrackSelected = 0
let TrackObjects: Image[] = []
let img1X: number[] = []
let heading = 0
let finishLineY1 = 0
let finishLineX1 = 0
let finishLineY0 = 0
let finishLineX0 = 0
let collisionImage: Image = null
let px = 0
let py = 0
let carAngularVelocity: number = 0
let carPower: number = 0
let treeImage = 0
let dy = 0
setarrays()
let inMenu = true
let inMenuNum = 1
let OptionsInMenuX = 4
let OptionsInMenuY = 2
let menuscreen = sprites.create(img`
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999944444444499999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999944444444444444444999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999444444444444444444444449999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999944444444444999999994444444999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999944444444499999999999444444499999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999944444444999999999999944444499999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999944444449999999999999944444449999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999444444449999999999999944444444994444444444999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999444444449999999999999994444444444444444444499999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999444444449999999999999994444444444444444444444999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999994444444449999999999999994444444444444444444444499999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999944444444449999999999999994444444444444444444444449999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999444444444449999999999994444444444444444444444444449999999999999999999999999999999999999999999999999999999999999994444444449999999999999999999999999999999999
    9994444444444444999999999999444444444444499999944444449999999999999999999999999999999999999999999999999999999999444444444444444499999999999999999999999999999999
    9994444444444444444499999999999444449999999999994444449999999999999999999999999944444999999994444499999999944444444444444444444444999999999999999999999999999999
    9994444444444444444449999999999999999999999999994444449999999999999999999444999444444444499944444444499944444444444444444444444444499999999999999999999999999999
    9994444444444444444499999999999999999999999999994444449999999999999999944444444444444444444444444444444444444444444444444444444444449999999999999999999999999999
    9994444444444444444499999999999999999999999999999444449999999944449999444444444444444444444444444444444444444444444444444444444444444999999999999999999999999999
    9999444444444444499999999999999999999999999999999444449999444444444494444444444444444444444444444444444444444444444444444444444444444444999999999999999999999999
    9999444444449999999999999999999999999999999999999444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444499999999999999999999
    9999444449999999999999999999999999999999999999999444444444444444444444444444444444444499944444449994444444444444444444444444444444444444444444999999999999999999
    9999444449999999999999999999999999999999999999999944444444444449994444444499944444444999944444449994444444444444444444999994444444444444444444444444444449999999
    9999444449999999999999999999999999999999999999999444444444444499994444444999944444444999944444449994444444499944444499999994444444444444444444444444444444499999
    9999444444999999999999999999999999999999999999994444444444444499994444444999944444444999944444449994444444999944449999999994444444444444444499944444444444449999
    9999444444999999999999999999999999999999999999994444444444444499994444444999944444444999944444449994444449999944499999999444444444444444444499944444444444444999
    9994444444999999999999999999999999999999999999444444444444444999994444444999944444444999994444449994444499999444499999444444444444444444444499944444444444444999
    9994444444999999999999999999999999999999999944444444444444444999999444444999944444444999994444449994444999994444999994444444444444444444444499944444444444444499
    9994444444499999999999999999999999999999999444444444444444444999999444449999994444444999994444449994449999944444999944444444444444444444444499944444444444444499
    9944444444499999999999999999999999999999999444444444444444449999999444449999994444444999994444449994499999444449999444444444444444444444444499994444444444444499
    9444444444499999999999999999999999999999999444444444444444449999999444449999994444449999999444449994999994444449999444444444444444444444444499994444444444444499
    9444444444449999999999999999999999999999999444444444444444449994999944449999994444449999999444449999999944999449999444444444444444444444444499994444449994444449
    9444444444449999999999999999999999999999999444444444444444499994999944449999999444449994999444449999999444944449994444444444444444444444444449994449999999944449
    9444444444449999999999999999999999999999999444444444444444499994499944499999999444449994999444449999999444994499994444444444449994444444444449994499999999944449
    9444499999449999999999999999999999999999999944444999944444499944499944499994999444449994999944449999999944944499994444444449999999944444444499994999999999944449
    4444999999944999999999999999999999999999999999999999994444999944499994499944999444449994999944449999999944999499994444444499999999994444499999999999994499944449
    4449999999999999999999999999999999999999999999999999994444999944499994499944999444449994499944449994499944444499944444444999999999999499999999949999444499994449
    4499999999999999999999999999999999999999999999999999994444999444449994999944999944449999999944449994499994444499944444444999994449999999999999999994444499994449
    4499999999999999999999999999999999999999999999999999994449999444449999999944999944499999999994449994499994444499944444449999944444999999999999999994444449994449
    4499999999999999999999999999999999999999999999999999999449999444449999999444499944499999999994449994449994444499944444449999444444999999944499999994444449994449
    4499999999999999999999999999999999999999999999999999999449994444444999999444499944499944449994449994449999444499944444449994444444499999444499999999999999994449
    4499999999999999999999999999999999999999999999999999999499994444444999999444499994499944449994449994449999444499944444449994444444499994444499999999999999994444
    9449999999999999999999999999999999999999999999999999999499994444444999999444499994499944449999449994444999444499994444449994444444499994444499999999999999994444
    9449999999999999999999999999999999999999999999999999999499944444444999999444449994499944449999449994444999944499999444449999444444499994444499999944444444444444
    9444999999994449999999999999999999999999999999999999999999944444444499994444449994499944444999449994444999944499999944449999444444499994444999999944444444444444
    9444449999944449999999999999999999999999999999999999999999944444444499994444449994499944444999449994444499944449999944444999994444999994444999999994444444444444
    9444444444444444999999999999999999999999999999999999944999444444444499994444449999499944444999949994444499994444999999944999999449999999944999999994444444444444
    9444444444444444999999999999999999999999999999999444444999444444444499994444449999499944444999949994444499994444499999944499999999999999999999499999944444444444
    9944444444444444999999999999999999999999999994444444444999444444444449994444444999444444444499949994444449994444499999944449999999999999999999449999999999444444
    9944444444444444999999999999999999999999944444444444444444444444444444444444444444444444444444444444444444444444444444444444499999994449999999449999999999444444
    9994444444444444499999999999999999999444444444444444444444444444444444444444444449994444444444444449994444444444444444444444449999444444444444444499999999444444
    9999444444444444499999999999999994444444444444444444444444444444444444444444444449994444444499944499999444444444444444444499944444444444444444444444444444444449
    9999444444444444499999999999944444444444444444444444444444444444444444444444444449994444449999944499999444444444444444444499944444444444444444444444444444444499
    9999999994444444499999999444444444444444444444444444444444444444444444444444444449994444499999944499999444444444444444444499944444444444444444444444444444499999
    9999999999444444499994444444444444444444444444444444444444444444444444444444444449994444999999444499999444444444999444444499944444444444449999999944449999999999
    9999999999444444444444444444444444444444444444444444444444444444444444444444444449994499999944444999999944444449999444444499944444444444499999999999999999999999
    9999999999944444444444444444444444444444444444444444444444444444444444444444444449994999999444444999999944444499999944444499944444444444999999999999999999999999
    9999999999944444444444444444444444444444444444444444444444444444444444444444444449999999994444444999499944444999999994499999999994444444999999999999999999999999
    9999999999944444444444444444444444444444444444444444444444444444444444444944444449999999944444444999499944449999999999499999999994444444999999999999999999999999
    9999999999994444444444444444444444444444444444444444499999944444444444449944444449999999944444444999499944449999449999499999999994444444999999999999999999999999
    9999999999999444444444444444444444444444444444444499999999994444444444999944444449999499994444449999499994449994444999444499944444444444999999999999999999999999
    9999999999999944444444444444444444444444444999999999999999999444444499999944444449994499994444449999499994449994444444444499944444444444999999999999999999999999
    9999999999999994444444444444444444444449999999999999999999999994444999999944444449994449994444449999999994449994444444444499944444444444999999999999999999999999
    9999999999999999994444444999999999999999999999999999999999999999999999999994444449994449999444449999999994449994444444444499944444444444999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999994444449994449999444499999999999449994444444444499944444444444999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999994444449994444999944499994449999449994444444444499944444444449999999999999999999999999
    99999999999999999999999999999999999999999999999999999999999999999999999999944cccccccc444999944499944444999449994444444444499944444444449999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999994cccccccccc44499944499944444999449994444444444499944444444449999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999cccbbbbbccc4499994499944444999949994444444444499944444444499999999999999999999999999
    999999999999999999999999999999999999999999999999999999999999999999999999999cccbbbbbbbcc449999449994444499994999444444444449ccccc44444499999999999999999999999999
    99999999999999999999999999999999999999999999999999999999999999999999999999cccbbbbbbbbcc4449994499944444499949994444444444cccccccc4444499999999999999999999999999
    99999999999999999999999999999999999999999999999999999999999999999999999999ccbbbbbbbbbcc444444444444444444444999444444444cccbbbbbcc444999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999cccbbbbbbbbbcc44444444444444444444444444444444cccbbbbbbbcc44999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999cccbbbbbbbbbcc44444444444444444444444444444444ccbbbbbbbbbc49999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999cccbbbbbbbbbcc44444444444444444444444444444999ccbbbbbbbbcc99999999999999999999999999999
    99999999999999999999999999999999999999999999999999999999999999999999999999cccbbbbbbbccc9999944444449944444444444449999cccbbbbbbbbcc99999999999999999999999999999
    99999999999999999999999999999999999999999999999999999999999999999999999999ccccbbbbbcccc99999999999999999944449999999999ccbbbbbbbbcc99999999999999999999999999999
    999999999999999999999999999999999999999999999999999999999999999999999999999ccccccccccc999999999999999999999999999999999ccbbbbbbbbcc99999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999ccccccccc9999999999999999999999999999999999cccbbbbbcccc99999999999999999999999999999
    99999999999999999999999999999999999999999999999999999999999999999999999999999ccccc99999999999999999999999999999999999999cccccccccc999999999999999999999999999999
    999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999ccccc99999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    `, SpriteKind.menuElement)
menuscreen.z = 3
let Selector = sprites.create(img`
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    `, SpriteKind.menuElement)
Selector.z = 4
Selector.scale = 2
Selector.setPosition(48, 40)
animation.runImageAnimation(
Selector,
[img`
    . . . . . . . . . . . . . . . 1 1 . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . 1 1 . . . . . . . . . . . . . . . 
    `,img`
    . . . . . . . . . . . . . . 1 1 1 1 . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . 1 1 1 1 . . . . . . . . . . . . . . 
    `,img`
    . . . . . . . . . . . . . 1 1 1 1 1 1 . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . 1 1 1 1 1 1 . . . . . . . . . . . . . 
    `,img`
    . . . . . . . . . . . . 1 1 1 1 1 1 1 1 . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . 1 1 1 1 1 1 1 1 . . . . . . . . . . . . 
    `,img`
    . . . . . . . . . . . 1 1 1 1 1 1 1 1 1 1 . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . 1 1 1 1 1 1 1 1 1 1 . . . . . . . . . . . 
    `,img`
    . . . . . . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . . . . . 
    `,img`
    . . . . . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . . . . 
    `,img`
    . . . . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . . . 
    `,img`
    . . . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . . 
    `,img`
    . . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . . 
    `,img`
    . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . . 
    `,img`
    . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . . 
    `,img`
    . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . 
    `,img`
    . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . 
    `,img`
    . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . 
    `,img`
    . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . . . 
    `,img`
    . . . 1 1 1 1 1 1 1 1 1 1 1 1 . . 1 1 1 1 1 1 1 1 1 1 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 1 1 1 1 1 1 1 1 1 1 . . 1 1 1 1 1 1 1 1 1 1 1 1 . . . 
    `,img`
    . . . 1 1 1 1 1 1 1 1 1 1 1 . . . . 1 1 1 1 1 1 1 1 1 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 1 1 1 1 1 1 1 1 1 . . . . 1 1 1 1 1 1 1 1 1 1 1 . . . 
    `,img`
    . . . 1 1 1 1 1 1 1 1 1 1 . . . . . . 1 1 1 1 1 1 1 1 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 1 1 1 1 1 1 1 1 . . . . . . 1 1 1 1 1 1 1 1 1 1 . . . 
    `,img`
    . . . 1 1 1 1 1 1 1 1 1 . . . . . . . . 1 1 1 1 1 1 1 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 1 1 1 1 1 1 1 . . . . . . . . 1 1 1 1 1 1 1 1 1 . . . 
    `,img`
    . . . 1 1 1 1 1 1 1 1 . . . . . . . . . . 1 1 1 1 1 1 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 1 1 1 1 1 1 . . . . . . . . . . 1 1 1 1 1 1 1 1 . . . 
    `,img`
    . . . 1 1 1 1 1 1 1 . . . . . . . . . . . . 1 1 1 1 1 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 1 1 1 1 1 . . . . . . . . . . . . 1 1 1 1 1 1 1 . . . 
    `,img`
    . . . 1 1 1 1 1 1 . . . . . . . . . . . . . . 1 1 1 1 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 1 1 1 1 . . . . . . . . . . . . . . 1 1 1 1 1 1 . . . 
    `,img`
    . . . 1 1 1 1 1 . . . . . . . . . . . . . . . . 1 1 1 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 1 1 1 . . . . . . . . . . . . . . . . 1 1 1 1 1 . . . 
    `,img`
    . . . 1 1 1 1 . . . . . . . . . . . . . . . . . . 1 1 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 1 1 . . . . . . . . . . . . . . . . . . 1 1 1 1 . . . 
    `,img`
    . . . 1 1 1 . . . . . . . . . . . . . . . . . . . . 1 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 1 . . . . . . . . . . . . . . . . . . . . 1 1 1 . . . 
    `,img`
    . . . 1 1 . . . . . . . . . . . . . . . . . . . . . . 1 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 1 . . . . . . . . . . . . . . . . . . . . . . 1 1 . . . 
    `,img`
    . . . 1 . . . . . . . . . . . . . . . . . . . . . . . . 1 . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . 1 . . . . . . . . . . . . . . . . . . . . . . . . 1 . . . 
    `,img`
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    `,img`
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    `,img`
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    `,img`
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
    `],
30,
true
)
let textSprite = textsprite.create("Play")
textSprite.z = 3
textSprite.setPosition(48, 40)
textSprite = textsprite.create("Credits")
textSprite.z = 3
textSprite.setPosition(48, 60)
let throttle = 1
let trackImage: Image
configure()
let carSprite = sprites.create(img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . 1 1 1 1 1 1 . . . . . 
    . . . . 1 . . . . . . 1 . . . . 
    . . . . . . . . . . . 1 . . . . 
    . . . . . . . . . . . 1 . . . . 
    . . . . . . . . . . . 1 . . . . 
    . . . . . . . . . . 1 . . . . . 
    . . . . . . . . . 1 . . . . . . 
    . . . . . . . . 1 . . . . . . . 
    . . . . . . . . 1 . . . . . . . 
    . . . . . . . . 1 . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . 1 . . . . . . . 
    . . . . . . . . . . . . . . . . 
    `, SpriteKind.Player)
carSprite.z = 1
carSprite.scale = 2
let pxPrev = px
let pyPrev = py
// How far behind the player should the camera be placed?
let followDistance = 20
// Horizontal field of view in degrees. See backgroundImage comments,
// it should be matched to the background image width.
let fov = 50
// Y position of the horizon. Must match the backgroundImage (half) height.
let horizonY = 40
// Z near and far (horizon) view distances
let zNear = 20
let zFar = 325
renderer.setUp(drawSprites)
renderer.placePlayerSprite(carSprite, 12, 17)
let carDragSidewaysDrift = 0.04
let carDragForward = 0.03
let carDragOffroad = 0.06
let carDragSideways = 1
let carAngularDragDrift = 100
finishLineX0 = 116
finishLineY0 = 14
finishLineX1 = 116
finishLineY1 = 98
let carAngularDrag = 0.85
setUpTrack2()
px = 100
py = 60
heading = 230
enum TerrainType {
    ROAD,
    OFFROAD,
    OBSTACLE,
    FINISH_LINE
}
carSprite.y = 100
game.onUpdate(function () {
    if (!(inMenu)) {
        carAngularDrag = 0.75 + Math.abs(carVx + carVy) / 20
        if (controller.B.isPressed()) {
            carAngularDragDrift = 20
        } else {
            carAngularDragDrift = 100
        }
    }
})
game.onUpdate(function () {
    if (!(inMenu)) {
        if (controller.left.isPressed()) {
            carSprite.setImage(CharacterAnimateLeft[char])
        } else if (controller.right.isPressed()) {
            carSprite.setImage(CharacterAnimateRight[char])
        } else {
            carSprite.setImage(ImagesForCharacters[char])
        }
        terrain3 = getTerrainType(pxPrev, pyPrev, px, py)
        pxPrev = px
        pyPrev = py
        isOffroad = terrain3 == TerrainType.OFFROAD
        if (isOffroad) {
            carSprite.startEffect(effects.spray, 100)
        }
        // carSprite.sayText("" + terrain)
        // Is it crossing the finish line?
        if (terrain3 == TerrainType.FINISH_LINE) {
            if (!(onFinishLine)) {
                if (lapStart) {
                    lapTime = game.runtime() - lapStart
                    // carSprite.say("" + lapTime)
                    seconds = Math.round(lapTime / 100) / 10
                    info.setScore(1200 - seconds * 10)
                    carSprite.sayText("Lap: " + seconds + "s", 2000)
                    effects.confetti.startScreenEffect(2000)
                }
                onFinishLine = true
            }
        } else {
            if (onFinishLine) {
                if (!(lapStart)) {
                    info.setScore(0)
                }
                lapStart = game.runtime()
                onFinishLine = false
            }
        }
        // carSprite.say("" + Math.floor(controller.player1.dx(999)) + " " + controller.player1.analog)
        carAngularVelocity += controller.dx(12)
        heading += carAngularVelocity
        let angularDrag = controller.B.isPressed() ? carAngularDragDrift : carAngularDrag
carAngularVelocity *= carAngularDrag
if (heading < 0) {
            heading += 360
        }
        if (heading >= 360) {
            heading += 0 - 360
        }
        fwdX = Math.sin(heading * Math.PI / 180)
        fwdY = 0 - Math.cos(heading * Math.PI / 180)
        let deltaTime = control.eventContext().deltaTime
carPower = controller.A.isPressed() ? 2 * deltaTime : controller.dy(-2)
carVx += carPower * fwdX
        carVy += carPower * fwdY
        if (collisionImage.getPixel(px + carVx, py) == 3) {
            carSprite.startEffect(effects.fire, 200)
        } else if (collisionImage.getPixel(px + carVx, py) == 13 && carSprite.y == 100) {
            carSprite.startEffect(effects.fire, 200)
        } else {
            px += carVx
        }
        if (collisionImage.getPixel(px, py + carVy) == 3) {
            carSprite.startEffect(effects.fire, 200)
        } else if (collisionImage.getPixel(px, py + carVy) == 13 && carSprite.y == 100) {
            carSprite.startEffect(effects.fire, 200)
        } else {
            py += carVy
        }
        if (collisionImage.getPixel(px, py) == 8 && carSprite.y == 100) {
            carSprite.ay = -500
            carSprite.vy = -210
            timer.after(90, function () {
                carSprite.ay = 500
            })
        } else if (collisionImage.getPixel(px, py) == 12 && carSprite.y == 100) {
            carSprite.ay = -500
            carSprite.vy = -210
            gliding = 1
            timer.after(90, function () {
                carSprite.ay = 500
            })
        } else if (collisionImage.getPixel(px, py) == 0 && carSprite.y == 100) {
            memvarX = 512
            memvarY = 512
            for (let index = 0; index <= respawnX.length; index++) {
                if (Math.abs(px - respawnX[index]) + Math.abs(py - respawnY[index]) < Math.abs(px - memvarX) + Math.abs(py - memvarY)) {
                    memvarX = respawnX[index]
                    memvarY = respawnY[index]
                }
            }
            px = memvarX
            py = memvarY
            carVx = 0
            carVy = 0
            carSprite.y = 20
            carSprite.ay = 500
        } else {
        	
        }
        if (carSprite.vy > 0 && carSprite.y > 100) {
            carSprite.ay = 0
            carSprite.vy = 0
            carSprite.y = 100
            gliding = 0
        }
        if (carSprite.vy > 0 && gliding == 1) {
            gliding = 2
        }
        if (gliding == 2) {
            if (controller.player2.isPressed(ControllerButton.Up)) {
                storedgliderspeed += 1
                carSprite.ay = 100
            } else if (controller.player2.isPressed(ControllerButton.Down) && storedgliderspeed > 0) {
                carSprite.ay = -200
                storedgliderspeed += -1
            } else {
                carSprite.ay = 0
                carSprite.vy = 40
            }
        }
        forwardDrag = carDragForward
        let sidewaysDrag = controller.B.isPressed() ? carDragSidewaysDrift : carDragSideways
if (isOffroad) {
            forwardDrag = carDragOffroad
            sidewaysDrag = carDragOffroad
        }
        // Forward velocity is dot(carV, fwd) * fwd
        // Sideways (right) velocity is dot(carV, right) * right; with right = (-fwdY, fwdX)
        dot_V_Forward = carVx * fwdX + carVy * fwdY
        dot_V_Right = carVy * fwdX - carVx * fwdY
        // console.log("" + dot_V_Forward + ", " + dot_V_Right)
        carVx += 0 - (forwardDrag * dot_V_Forward * fwdX - sidewaysDrag * dot_V_Right * fwdY)
        carVy += 0 - (forwardDrag * dot_V_Forward * fwdY + sidewaysDrag * dot_V_Right * fwdX)
        if (px < 0) {
            px = 0
        }
        if (py < 0) {
            py = 0
        }
        if (px > trackImage.width) {
            px = trackImage.width
        }
        if (py > trackImage.height) {
            py = trackImage.height
        }
    } else {
        if (inMenuNum == 1) {
            if (controller.A.isPressed()) {
                if (SelectedY == 0) {
                    timer.throttle("action", 500, function () {
                        color.FadeToWhite.startScreenEffect(500)
                        timer.after(500, function () {
                            menuscreen.setImage(img`
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
                                `)
                            color.startFade(color.White, color.originalPalette, 500)
                            inMenuNum = 2
                            sprites.destroyAllSpritesOfKind(SpriteKind.Text)
                            TrackName = textsprite.create("KIWIPHOENIX")
                            TrackName.z = 3
                            animation.runImageAnimation(
                            Selector,
                            [img`
                                . . . . . 1 1 . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . 1 1 . . . . . 
                                `,img`
                                . . . . 1 1 1 1 . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . 1 1 1 1 . . . . 
                                `,img`
                                . . . 1 1 1 1 1 1 . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . 1 1 1 1 1 1 . . . 
                                `,img`
                                . . 1 1 1 1 1 1 1 1 . . 
                                . . . . . . . . . . . . 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                . . . . . . . . . . . . 
                                . . 1 1 1 1 1 1 1 1 . . 
                                `,img`
                                . 1 1 1 1 1 1 1 1 1 1 . 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                . 1 1 1 1 1 1 1 1 1 1 . 
                                `,img`
                                1 1 1 1 1 1 1 1 1 1 1 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 1 1 1 1 1 1 1 1 1 1 1 
                                `,img`
                                1 1 1 1 1 . . 1 1 1 1 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 1 1 1 1 . . 1 1 1 1 1 
                                `,img`
                                1 1 1 1 . . . . 1 1 1 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 1 1 1 . . . . 1 1 1 1 
                                `,img`
                                1 1 1 . . . . . . 1 1 1 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                1 . . . . . . . . . . 1 
                                1 . . . . . . . . . . 1 
                                1 1 1 . . . . . . 1 1 1 
                                `,img`
                                1 1 . . . . . . . . 1 1 
                                1 . . . . . . . . . . 1 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                1 . . . . . . . . . . 1 
                                1 1 . . . . . . . . 1 1 
                                `,img`
                                1 . . . . . . . . . . 1 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                1 . . . . . . . . . . 1 
                                `,img`
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                . . . . . . . . . . . . 
                                `],
                            70,
                            true
                            )
                            timer.after(1, function () {
                                Selector.x = 36
                                for (let index2 = 0; index2 <= 7; index2++) {
                                    mySprite2 = sprites.create(ImagesForCharacters[index2], SpriteKind.Text)
                                    mySprite2.z = 3
                                    if (index2 < 4) {
                                        mySprite2.setPosition(36 + index2 * 28, 44)
                                    } else {
                                        mySprite2.setPosition(36 + (index2 - 4) * 28, 72)
                                    }
                                }
                            })
                        })
                    })
                } else if (SelectedY == 1) {
                    game.showLongText("Credits:                   Engine - Main renderer: KWX, Additions to code (in blocks, mainly menus and mechanics): Kiwiphoenix364                         Other stuff: Kiwiphoenix364, Erico, Colethewolf, Agent_14", DialogLayout.Full)
                    game.reset()
                } else {
                	
                }
            } else if (controller.up.isPressed()) {
                timer.debounce("action", 20, function () {
                    if (SelectedY > 0) {
                        SelectedY += -1
                        Selector.y += -20
                    } else {
                        SelectedY = OptionsInMenuY - 1
                        Selector.y = 40 + (OptionsInMenuY - 1) * 20
                    }
                })
            } else if (controller.down.isPressed()) {
                timer.debounce("action", 20, function () {
                    if (SelectedY < OptionsInMenuY - 1) {
                        SelectedY += 1
                        Selector.y += 20
                    } else {
                        SelectedY = 0
                        Selector.y = 40
                    }
                })
            }
        } else if (inMenuNum == 2) {
            TrackName.setPosition(Selector.x, Selector.y + 16)
            if (SelectedX + SelectedY * OptionsInMenuX == 0) {
                TrackName.setText("KIWIPHOENIX")
            } else if (SelectedX + SelectedY * OptionsInMenuX == 1) {
                TrackName.setText("AGENT14")
            } else if (SelectedX + SelectedY * OptionsInMenuX == 2) {
                TrackName.setText("COLETHEWOLF")
            } else if (SelectedX + SelectedY * OptionsInMenuX == 3) {
                TrackName.setText("ERICO")
            } else {
                TrackName.setText("?")
            }
            if (controller.A.isPressed()) {
                color.FadeToWhite.startScreenEffect(500)
                char = SelectedX + SelectedY * OptionsInMenuX
                carSprite.setImage(ImagesForCharacters[char])
                inMenuNum = 0
                timer.after(500, function () {
                    color.startFade(color.White, color.originalPalette, 500)
                    SelectedX = 0
                    SelectedY = 0
                    inMenuNum = 3
                    sprites.destroyAllSpritesOfKind(SpriteKind.Text)
                    animation.runImageAnimation(
                    Selector,
                    [img`
                        . . . . . 1 1 . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . 1 1 . . . . . 
                        `,img`
                        . . . . 1 1 1 1 . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . 1 1 1 1 . . . . 
                        `,img`
                        . . . 1 1 1 1 1 1 . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . 1 1 1 1 1 1 . . . 
                        `,img`
                        . . 1 1 1 1 1 1 1 1 . . 
                        . . . . . . . . . . . . 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        . . . . . . . . . . . . 
                        . . 1 1 1 1 1 1 1 1 . . 
                        `,img`
                        . 1 1 1 1 1 1 1 1 1 1 . 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        . 1 1 1 1 1 1 1 1 1 1 . 
                        `,img`
                        1 1 1 1 1 1 1 1 1 1 1 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 1 1 1 1 1 1 1 1 1 1 1 
                        `,img`
                        1 1 1 1 1 . . 1 1 1 1 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 1 1 1 1 . . 1 1 1 1 1 
                        `,img`
                        1 1 1 1 . . . . 1 1 1 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 1 1 1 . . . . 1 1 1 1 
                        `,img`
                        1 1 1 . . . . . . 1 1 1 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        1 . . . . . . . . . . 1 
                        1 . . . . . . . . . . 1 
                        1 1 1 . . . . . . 1 1 1 
                        `,img`
                        1 1 . . . . . . . . 1 1 
                        1 . . . . . . . . . . 1 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        1 . . . . . . . . . . 1 
                        1 1 . . . . . . . . 1 1 
                        `,img`
                        1 . . . . . . . . . . 1 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        1 . . . . . . . . . . 1 
                        `,img`
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        . . . . . . . . . . . . 
                        `],
                    70,
                    true
                    )
                    Selector.x = 36
                    for (let index3 = 0; index3 <= 7; index3++) {
                        mySprite2 = sprites.create(ImagesForCups[index3], SpriteKind.Text)
                        mySprite2.z = 3
                        if (index3 < 4) {
                            mySprite2.setPosition(36 + index3 * 28, 44)
                        } else {
                            mySprite2.setPosition(36 + (index3 - 4) * 28, 72)
                        }
                    }
                })
            } else if (controller.up.isPressed()) {
                timer.debounce("action", 20, function () {
                    if (SelectedY > 0) {
                        SelectedY += -1
                        Selector.y += -28
                    } else {
                        SelectedY = OptionsInMenuY - 1
                        Selector.y = 44 + (OptionsInMenuY - 1) * 28
                    }
                })
            } else if (controller.down.isPressed()) {
                timer.debounce("action", 20, function () {
                    if (SelectedY < OptionsInMenuY - 1) {
                        SelectedY += 1
                        Selector.y += 28
                    } else {
                        SelectedY = 0
                        Selector.y = 44
                    }
                })
            } else if (controller.left.isPressed()) {
                timer.debounce("action", 20, function () {
                    if (SelectedX > 0) {
                        SelectedX += -1
                        Selector.x += -28
                    } else {
                        SelectedX = OptionsInMenuX - 1
                        Selector.x = 36 + (OptionsInMenuX - 1) * 28
                    }
                })
            } else if (controller.right.isPressed()) {
                timer.debounce("action", 20, function () {
                    if (SelectedX < OptionsInMenuX - 1) {
                        SelectedX += 1
                        Selector.x += 28
                    } else {
                        SelectedX = 0
                        Selector.x = 36
                    }
                })
            }
        } else if (inMenuNum == 3) {
            if (controller.A.isPressed()) {
                if (SelectedX + SelectedY * OptionsInMenuX == 0) {
                    timer.throttle("action", 200, function () {
                        timer.background(function () {
                            color.setColor(3, color.rgb(0, 168, 0))
                            color.setColor(12, color.rgb(96, 96, 96))
                            color.setColor(11, color.rgb(161, 145, 97))
                            inMenuNum = 0
                            CupSelected = SelectedX + SelectedY * OptionsInMenuX
                            OptionsInMenuX = 4
                            Selector.setPosition(50, 100)
                            mySprite = sprites.create(img`
                                ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
                                f9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999f
                                f999999999999999999999999999999999999ffffffffffffffff9999ffffffffffffffff9999ffffffffffffffff9999ffffffffffffffff999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f..............f9999f..............f9999f..............f9999f..............f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f..............f9999f..............f9999f..............f9999f..............f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f.....ffff.....f9999f.....ffff.....f9999f.....ffff.....f9999f.....ffff.....f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f....f....f....f9999f....f....f....f9999f....f....f....f9999f....f....f....f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f.........f....f9999f.........f....f9999f.........f....f9999f.........f....f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f.........f....f9999f.........f....f9999f.........f....f9999f.........f....f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f.........f....f9999f.........f....f9999f.........f....f9999f.........f....f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f........f.....f9999f........f.....f9999f........f.....f9999f........f.....f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f.......f......f9999f.......f......f9999f.......f......f9999f.......f......f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f.......f......f9999f.......f......f9999f.......f......f9999f.......f......f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f..............f9999f..............f9999f..............f9999f..............f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f.......f......f9999f.......f......f9999f.......f......f9999f.......f......f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f..............f9999f..............f9999f..............f9999f..............f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999f..............f9999f..............f9999f..............f9999f..............f999999999999999999999999999999999999f
                                f999999999999999999999999999999999999ffffffffffffffff9999ffffffffffffffff9999ffffffffffffffff9999ffffffffffffffff999999999999999999999999999999999999f
                                f9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999f
                                f9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999f
                                f9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999f
                                f9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999f
                                f9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999f
                                f9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999f
                                f9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999f
                                f9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999f
                                f9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999f
                                f9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999f
                                f9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999f
                                f9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999f
                                `, SpriteKind.Text)
                            mySprite.y = 135
                            mySprite.z = 3
                            TrackName = textsprite.create("")
                            TrackName.z = 4
                            TrackName.setPosition(48, 148)
                            for (let index4 = 0; index4 <= 3; index4++) {
                                TrackPreview = sprites.create(ImagesForTracks[index4 + CupSelected], SpriteKind.trackPreview)
                                TrackPreview.z = 3
                                TrackPreview.setPosition(index4 * 20 + 50, 130)
                            }
                            SelectedX = 0
                            SelectedY = 0
                            for (let index = 0; index < 30; index++) {
                                mySprite.y += -1
                                TrackName.y += -1
                                for (let value of sprites.allOfKind(SpriteKind.trackPreview)) {
                                    value.y += -1
                                }
                                pause(5)
                            }
                        })
                        timer.after(500, function () {
                            inMenuNum = 4
                        })
                    })
                } else if (SelectedY == 1) {
                	
                } else {
                	
                }
            } else if (controller.up.isPressed()) {
                timer.debounce("action", 20, function () {
                    if (SelectedY > 0) {
                        SelectedY += -1
                        Selector.y += -28
                    } else {
                        SelectedY = OptionsInMenuY - 1
                        Selector.y = 44 + (OptionsInMenuY - 1) * 28
                    }
                })
            } else if (controller.down.isPressed()) {
                timer.debounce("action", 20, function () {
                    if (SelectedY < OptionsInMenuY - 1) {
                        SelectedY += 1
                        Selector.y += 28
                    } else {
                        SelectedY = 0
                        Selector.y = 44
                    }
                })
            } else if (controller.left.isPressed()) {
                timer.debounce("action", 20, function () {
                    if (SelectedX > 0) {
                        SelectedX += -1
                        Selector.x += -28
                    } else {
                        SelectedX = OptionsInMenuX - 1
                        Selector.x = 36 + (OptionsInMenuX - 1) * 28
                    }
                })
            } else if (controller.right.isPressed()) {
                timer.debounce("action", 20, function () {
                    if (SelectedX < OptionsInMenuX - 1) {
                        SelectedX += 1
                        Selector.x += 28
                    } else {
                        SelectedX = 0
                        Selector.x = 36
                    }
                })
            }
        } else if (inMenuNum == 4) {
            TrackName.setPosition(Selector.x, Selector.y + 16)
            TrackName.setText(TrackNames[SelectedX + CupSelected * 4])
            if (controller.A.isPressed()) {
                if (SelectedX + CupSelected * 4 < TrackCollision_Images.length / 2) {
                    inMenuNum = 0
                    sprites.destroyAllSpritesOfKind(SpriteKind.Text)
                    sprites.destroyAllSpritesOfKind(SpriteKind.menuElement)
                    sprites.destroyAllSpritesOfKind(SpriteKind.trackPreview)
                    inMenu = false
                    TrackSelected = CupSelected * 4 + SelectedX
                    trackImage = TrackCollision_Images[TrackSelected * 2]
                    collisionImage = TrackCollision_Images[TrackSelected * 2 + 1]
                    // Color used for drawing ground outside the track texture.
                    outsideTrackColor = OutsideTrackColors[TrackSelected]
                    initializeTrack()
                } else if (SelectedX == 1) {
                	
                } else {
                	
                }
            } else if (controller.left.isPressed()) {
                timer.debounce("action", 20, function () {
                    if (SelectedX > 0) {
                        SelectedX += -1
                        Selector.x += -20
                    } else {
                        SelectedX = OptionsInMenuX - 1
                        Selector.x = 50 + (OptionsInMenuX - 1) * 20
                    }
                })
            } else if (controller.right.isPressed()) {
                timer.debounce("action", 20, function () {
                    if (SelectedX < OptionsInMenuX - 1) {
                        SelectedX += 1
                        Selector.x += 20
                    } else {
                        SelectedX = 0
                        Selector.x = 50
                    }
                })
            }
        } else {
        	
        }
    }
})
